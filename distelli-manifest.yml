ipcrm/hello_world_java:
  Env:
    - PORT: "10555"
  Build:
    - mvn package
    - docker login -u "$DISTELLI_DOCKER_USERNAME" -p "$DISTELLI_DOCKER_PW" $DISTELLI_DOCKER_ENDPOINT
    - docker build --quiet=false -t "$DISTELLI_DOCKER_REPO" $DISTELLI_DOCKER_PATH
    - docker tag "$DISTELLI_DOCKER_REPO" "$DISTELLI_DOCKER_REPO:$DISTELLI_BUILDNUM"
    - docker push "$DISTELLI_DOCKER_REPO:$DISTELLI_BUILDNUM"
  Start:
    - if [ `sudo docker service  inspect "$DISTELLI_ENV" &> /dev/null` ]; then
    -   sudo docker service update --image "$DISTELLI_DOCKER_REPO:$DISTELLI_BUILDNUM" "$DISTELLI_ENV"
    - else
    -   sudo docker service create --name "$DISTELLI_ENV" --publish published="$PORT",target=9999 --replicas 2 "$DISTELLI_DOCKER_REPO:$DISTELLI_BUILDNUM"
    - fi
  Terminate:
    - sudo docker service rm "$DISTELLI_ENV"
